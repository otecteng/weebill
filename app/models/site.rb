 # encoding: utf-8
class Site < ActiveRecord::Base
  attr_accessible :address, :cert, :city, :contactor, :county, :location, :name, :province, :star,:alipay_account,:tencent_account,
  					:phone
  has_many :service_orders
  has_many :site_workers
  belongs_to :user
  scope :city, lambda {|city| where(:city => city)}
  scope :county, lambda {|city,county| where(:city => city,:county=>county)}
  scope :need_update, lambda {where(:star => "*")}
  
  def self.get_region(name)
    @regions = File.open("#{Rails.root}/config/regions.yml") { |file| YAML.load(file) }
  end

  def self.confirm_city(city)
    unless @sites 
      @sites = [
        {"lng"=>116.521695, "lat"=>39.958953, :city=>"朝阳区", :province=>"北京市"},{"lng"=>116.239678, "lat"=>40.033162, :city=>"海淀区", :province=>"北京市"},{"lng"=>116.37319, "lat"=>39.93428, :city=>"西城区", :province=>"北京市"},{"lng"=>116.421885, "lat"=>39.938574, :city=>"东城区", :province=>"北京市"},{"lng"=>116.424636, "lat"=>39.889292, :city=>"崇文区", :province=>"北京市"},{"lng"=>116.369352, "lat"=>39.891531, :city=>"宣武区", :province=>"北京市"},{"lng"=>116.25837, "lat"=>39.841938, :city=>"丰台区", :province=>"北京市"},{"lng"=>116.184556, "lat"=>39.938867, :city=>"石景山区", :province=>"北京市"},{"lng"=>115.795795, "lat"=>40.000893, :city=>"门头沟", :province=>"北京市"},{"lng"=>115.862836, "lat"=>39.726753, :city=>"房山区", :province=>"北京市"},{"lng"=>116.740079, "lat"=>39.809815, :city=>"通州区", :province=>"北京市"},{"lng"=>116.425195, "lat"=>39.65279, :city=>"大兴区", :province=>"北京市"},{"lng"=>116.728229, "lat"=>40.154951, :city=>"顺义区", :province=>"北京市"},{"lng"=>116.593408, "lat"=>40.638139, :city=>"怀柔区", :province=>"北京市"},{"lng"=>117.001201, "lat"=>40.532843, :city=>"密云区", :province=>"北京市"},{"lng"=>116.216456, "lat"=>40.221724, :city=>"昌平区", :province=>"北京市"},{"lng"=>117.150433, "lat"=>40.215925, :city=>"平谷区", :province=>"北京市"},{"lng"=>116.169735, "lat"=>40.545156, :city=>"延庆县", :province=>"北京市"},
        {"lng"=>121.496072, "lat"=>31.227203, :city=>"黄浦区", :province=>"上海市"},{"lng"=>121.481238, "lat"=>31.213348, :city=>"卢湾区", :province=>"上海市"},{"lng"=>121.446235, "lat"=>31.169152, :city=>"徐汇区", :province=>"上海市"},{"lng"=>121.387616, "lat"=>31.213301, :city=>"长宁区", :province=>"上海市"},{"lng"=>121.454756, "lat"=>31.235381, :city=>"静安区", :province=>"上海市"},{"lng"=>121.457769, "lat"=>31.288044, :city=>"闸北区", :province=>"上海市"},{"lng"=>121.491919, "lat"=>31.282497, :city=>"虹口区", :province=>"上海市"},{"lng"=>121.535717, "lat"=>31.30451, :city=>"杨浦区", :province=>"上海市"},{"lng"=>131.564836, "lat"=>46.529228, :city=>"宝山区", :province=>"上海市"},{"lng"=>121.425024, "lat"=>31.093538, :city=>"闵行区", :province=>"上海市"},{"lng"=>121.251014, "lat"=>31.364338, :city=>"嘉定区", :province=>"上海市"},{"lng"=>121.638481, "lat"=>31.230895, :city=>"浦东新区", :province=>"上海市"},{"lng"=>121.091425, "lat"=>31.130862, :city=>"青浦区", :province=>"上海市"},{"lng"=>121.226791, "lat"=>31.021245, :city=>"松江区", :province=>"上海市"},{"lng"=>121.248408, "lat"=>30.835081, :city=>"金山区", :province=>"上海市"},{"lng"=>121.560642, "lat"=>30.915122, :city=>"奉贤区", :province=>"上海市"},{"lng"=>121.398443, "lat"=>31.263743, :city=>"普陀区", :province=>"上海市"},{"lng"=>121.535398, "lat"=>31.633565, :city=>"崇明县", :province=>"上海市"},
        {"lng"=>117.414782, "lat"=>39.139605, :city=>"东丽区", :province=>"天津市"},{"lng"=>117.202814, "lat"=>39.124809, :city=>"和平区", :province=>"天津市"},{"lng"=>117.220297, "lat"=>39.173149, :city=>"河北区", :province=>"天津市"},{"lng"=>117.261693, "lat"=>39.126626, :city=>"河东区", :province=>"天津市"},{"lng"=>117.236165, "lat"=>39.084494, :city=>"河西区", :province=>"天津市"},{"lng"=>117.162217, "lat"=>39.170621, :city=>"红桥区", :province=>"天津市"},{"lng"=>117.441159, "lat"=>40.009614, :city=>"蓟县", :province=>"天津市"},{"lng"=>116.972772, "lat"=>38.861262, :city=>"静海县", :province=>"天津市"},{"lng"=>117.162728, "lat"=>39.116987, :city=>"南开区", :province=>"天津市"},{"lng"=>117.649081, "lat"=>39.007936, :city=>"塘沽区", :province=>"天津市"},{"lng"=>117.126201, "lat"=>39.035065, :city=>"西青区", :province=>"天津市"},{"lng"=>117.034578, "lat"=>39.457043, :city=>"武清区", :province=>"天津市"},{"lng"=>117.39291, "lat"=>38.969791, :city=>"津南区", :province=>"天津市"},{"lng"=>117.87353, "lat"=>39.247773, :city=>"汉沽区", :province=>"天津市"},{"lng"=>117.380794, "lat"=>38.729573, :city=>"大港区", :province=>"天津市"},{"lng"=>117.180606, "lat"=>39.259131, :city=>"北辰区", :province=>"天津市"},{"lng"=>117.411421, "lat"=>39.615544, :city=>"宝坻区", :province=>"天津市"},{"lng"=>117.689424, "lat"=>39.381561, :city=>"宁河县", :province=>"天津市"},
        {"lng"=>108.413439, "lat"=>30.710054, :city=>"万州区", :province=>"重庆市"},{"lng"=>107.3408, "lat"=>29.664671, :city=>"涪陵区", :province=>"重庆市"},{"lng"=>107.725428, "lat"=>30.664363, :city=>"梁平县", :province=>"重庆市"},{"lng"=>107.177888, "lat"=>29.141686, :city=>"南川区", :province=>"重庆市"},{"lng"=>105.819679, "lat"=>30.149933, :city=>"潼南县", :province=>"重庆市"},{"lng"=>105.747626, "lat"=>29.660709, :city=>"大足区", :province=>"重庆市"},{"lng"=>108.714808, "lat"=>29.440981, :city=>"黔江区", :province=>"重庆市"},{"lng"=>107.716106, "lat"=>29.379271, :city=>"武隆县", :province=>"重庆市"},{"lng"=>107.837517, "lat"=>29.890596, :city=>"丰都县", :province=>"重庆市"},{"lng"=>109.355667, "lat"=>30.958553, :city=>"奉节县", :province=>"重庆市"},{"lng"=>108.38926, "lat"=>31.277101, :city=>"开县", :province=>"重庆市"},{"lng"=>108.863186, "lat"=>31.042409, :city=>"云阳县", :province=>"重庆市"},{"lng"=>107.921738, "lat"=>30.342003, :city=>"忠县", :province=>"重庆市"},{"lng"=>109.360531, "lat"=>31.509161, :city=>"巫溪县", :province=>"重庆市"},{"lng"=>109.908611, "lat"=>31.121152, :city=>"巫山县", :province=>"重庆市"},{"lng"=>108.30489, "lat"=>30.099637, :city=>"石柱县", :province=>"重庆市"},{"lng"=>108.272868, "lat"=>29.359628, :city=>"彭水县", :province=>"重庆市"},{"lng"=>107.444445, "lat"=>30.259498, :city=>"垫江县", :province=>"重庆市"},{"lng"=>108.806808, "lat"=>28.905278, :city=>"酉阳县", :province=>"重庆市"},{"lng"=>109.025321, "lat"=>28.498315, :city=>"秀山县", :province=>"重庆市"},{"lng"=>108.741855, "lat"=>31.888131, :city=>"城口县", :province=>"重庆市"},{"lng"=>106.198727, "lat"=>29.567502, :city=>"璧山县", :province=>"重庆市"},{"lng"=>105.512656, "lat"=>29.471196, :city=>"荣昌县", :province=>"重庆市"},{"lng"=>106.039243, "lat"=>29.818323, :city=>"铜梁县", :province=>"重庆市"},{"lng"=>106.318029, "lat"=>30.118708, :city=>"合川区", :province=>"重庆市"},{"lng"=>106.758274, "lat"=>29.378028, :city=>"巴南区", :province=>"重庆市"},{"lng"=>106.520342, "lat"=>29.866596, :city=>"北碚区", :province=>"重庆市"},{"lng"=>106.269282, "lat"=>29.035351, :city=>"江津区", :province=>"重庆市"},{"lng"=>106.753799, "lat"=>29.816264, :city=>"渝北区", :province=>"重庆市"},{"lng"=>107.146615, "lat"=>29.960491, :city=>"长寿区", :province=>"重庆市"},{"lng"=>105.880358, "lat"=>29.296488, :city=>"永川区", :province=>"重庆市"},{"lng"=>106.713615, "lat"=>29.619318, :city=>"江北区", :province=>"重庆市"},{"lng"=>106.667178, "lat"=>29.541515, :city=>"南岸区", :province=>"重庆市"},{"lng"=>106.370595, "lat"=>29.434566, :city=>"九龙坡区", :province=>"重庆市"},{"lng"=>106.374805, "lat"=>29.630548, :city=>"沙坪坝区", :province=>"重庆市"},{"lng"=>106.465322, "lat"=>29.42414, :city=>"大渡口区", :province=>"重庆市"},{"lng"=>106.679237, "lat"=>28.87614, :city=>"綦江区", :province=>"重庆市"},{"lng"=>106.546967, "lat"=>29.555236, :city=>"渝中区", :province=>"重庆市"},
        {"lng"=>114.522082, "lat"=>38.048958, :city=>"石家庄市", :province=>"河北省"},{"lng"=>114.482694, "lat"=>36.609308, :city=>"邯郸市", :province=>"河北省"},{"lng"=>114.520487, "lat"=>37.069531, :city=>"邢台市", :province=>"河北省"},{"lng"=>115.49481, "lat"=>38.886565, :city=>"保定市", :province=>"河北省"},{"lng"=>114.893782, "lat"=>40.811188, :city=>"张家口市", :province=>"河北省"},{"lng"=>117.933822, "lat"=>40.992521, :city=>"承德市", :province=>"河北省"},{"lng"=>119.604368, "lat"=>39.945462, :city=>"秦皇岛市", :province=>"河北省"},{"lng"=>118.183451, "lat"=>39.650531, :city=>"唐山市", :province=>"河北省"},{"lng"=>116.863806, "lat"=>38.297615, :city=>"沧州市", :province=>"河北省"},{"lng"=>116.703602, "lat"=>39.518611, :city=>"廊坊市", :province=>"河北省"},{"lng"=>115.686229, "lat"=>37.746929, :city=>"衡水市", :province=>"河北省"},{"lng"=>112.550864, "lat"=>37.890277, :city=>"太原市", :province=>"山西省"},{"lng"=>113.290509, "lat"=>40.113744, :city=>"大同市", :province=>"山西省"},{"lng"=>113.569238, "lat"=>37.869529, :city=>"阳泉市", :province=>"山西省"},{"lng"=>112.867333, "lat"=>35.499834, :city=>"晋城市", :province=>"山西省"},{"lng"=>112.479928, "lat"=>39.337672, :city=>"朔州市", :province=>"山西省"},{"lng"=>112.738514, "lat"=>37.693362, :city=>"晋中市", :province=>"山西省"},{"lng"=>112.727939, "lat"=>38.461031, :city=>"忻州市", :province=>"山西省"},{"lng"=>111.143157, "lat"=>37.527316, :city=>"吕梁市", :province=>"山西省"},{"lng"=>111.538788, "lat"=>36.099745, :city=>"临汾市", :province=>"山西省"},{"lng"=>111.006854, "lat"=>35.038859, :city=>"运城市", :province=>"山西省"},{"lng"=>113.120292, "lat"=>36.201664, :city=>"长治市", :province=>"山西省"},
        {"lng"=>111.660351, "lat"=>40.828319, :city=>"呼和浩特市", :province=>"内蒙古自治区"},{"lng"=>109.846239, "lat"=>40.647119, :city=>"包头市", :province=>"内蒙古自治区"},{"lng"=>106.831999, "lat"=>39.683177, :city=>"乌海市", :province=>"内蒙古自治区"},{"lng"=>118.930761, "lat"=>42.297112, :city=>"赤峰市", :province=>"内蒙古自治区"},{"lng"=>113.112846, "lat"=>41.022363, :city=>"乌兰察布市", :province=>"内蒙古自治区"},{"lng"=>116.02734, "lat"=>43.939705, :city=>"锡林郭勒盟", :province=>"内蒙古自治区"},{"lng"=>119.760822, "lat"=>49.201636, :city=>"呼伦贝尔市", :province=>"内蒙古自治区"},{"lng"=>109.993706, "lat"=>39.81649, :city=>"鄂尔多斯市", :province=>"内蒙古自治区"},{"lng"=>107.423807, "lat"=>40.76918, :city=>"巴彦淖尔市", :province=>"内蒙古自治区"},{"lng"=>105.695683, "lat"=>38.843075, :city=>"阿拉善盟", :province=>"内蒙古自治区"},{"lng"=>122.048167, "lat"=>46.083757, :city=>"兴安盟", :province=>"内蒙古自治区"},{"lng"=>122.260363, "lat"=>43.633756, :city=>"通辽市", :province=>"内蒙古自治区"},{"lng"=>123.432791, "lat"=>41.808645, :city=>"沈阳市", :province=>"辽宁省"},{"lng"=>121.593478, "lat"=>38.94871, :city=>"大连市", :province=>"辽宁省"},{"lng"=>123.007763, "lat"=>41.118744, :city=>"鞍山市", :province=>"辽宁省"},{"lng"=>123.92982, "lat"=>41.877304, :city=>"抚顺市", :province=>"辽宁省"},{"lng"=>123.778062, "lat"=>41.325838, :city=>"本溪市", :province=>"辽宁省"},{"lng"=>124.338543, "lat"=>40.129023, :city=>"丹东市", :province=>"辽宁省"},{"lng"=>121.147749, "lat"=>41.130879, :city=>"锦州市", :province=>"辽宁省"},{"lng"=>120.860758, "lat"=>40.74303, :city=>"葫芦岛市", :province=>"辽宁省"},{"lng"=>122.233391, "lat"=>40.668651, :city=>"营口市", :province=>"辽宁省"},{"lng"=>122.073228, "lat"=>41.141248, :city=>"盘锦市", :province=>"辽宁省"},{"lng"=>121.660822, "lat"=>42.01925, :city=>"阜新市", :province=>"辽宁省"},{"lng"=>123.172451, "lat"=>41.273339, :city=>"辽阳市", :province=>"辽宁省"},{"lng"=>120.446163, "lat"=>41.571828, :city=>"朝阳市", :province=>"辽宁省"},{"lng"=>123.85485, "lat"=>42.299757, :city=>"铁岭市", :province=>"辽宁省"},
        {"lng"=>125.313642, "lat"=>43.898338, :city=>"长春市", :province=>"吉林省"},{"lng"=>126.564544, "lat"=>43.871988, :city=>"吉林市", :province=>"吉林省"},{"lng"=>124.391382, "lat"=>43.175525, :city=>"四平市", :province=>"吉林省"},{"lng"=>125.94265, "lat"=>41.736397, :city=>"通化市", :province=>"吉林省"},{"lng"=>126.435798, "lat"=>41.945859, :city=>"白山市", :province=>"吉林省"},{"lng"=>124.832995, "lat"=>45.136049, :city=>"松原市", :province=>"吉林省"},{"lng"=>122.840777, "lat"=>45.621086, :city=>"白城市", :province=>"吉林省"},{"lng"=>129.485902, "lat"=>42.896414, :city=>"延边州", :province=>"吉林省"},{"lng"=>125.133686, "lat"=>42.923303, :city=>"辽源市", :province=>"吉林省"},
        {"lng"=>126.657717, "lat"=>45.773225, :city=>"哈尔滨市", :province=>"黑龙江省"},{"lng"=>123.987289, "lat"=>47.3477, :city=>"齐齐哈尔市", :province=>"黑龙江省"},{"lng"=>130.292472, "lat"=>47.338666, :city=>"鹤岗市", :province=>"黑龙江省"},{"lng"=>131.171402, "lat"=>46.655102, :city=>"双鸭山市", :province=>"黑龙江省"},{"lng"=>130.941767, "lat"=>45.32154, :city=>"鸡西市", :province=>"黑龙江省"},{"lng"=>125.02184, "lat"=>46.596709, :city=>"大庆市", :province=>"黑龙江省"},{"lng"=>128.910766, "lat"=>47.734685, :city=>"伊春市", :province=>"黑龙江省"},{"lng"=>129.608035, "lat"=>44.588521, :city=>"牡丹江市", :province=>"黑龙江省"},{"lng"=>130.284735, "lat"=>46.81378, :city=>"佳木斯市", :province=>"黑龙江省"},{"lng"=>131.019048, "lat"=>45.775005, :city=>"七台河市", :province=>"黑龙江省"},{"lng"=>127.50083, "lat"=>50.25069, :city=>"黑河市", :province=>"黑龙江省"},{"lng"=>126.989095, "lat"=>46.646064, :city=>"绥化市", :province=>"黑龙江省"},{"lng"=>124.196104, "lat"=>51.991789, :city=>"大兴安岭地区", :province=>"黑龙江省"},{"lng"=>118.778074, "lat"=>32.057236, :city=>"南京市", :province=>"江苏省"},{"lng"=>117.188107, "lat"=>34.271553, :city=>"徐州市", :province=>"江苏省"},{"lng"=>119.173872, "lat"=>34.601549, :city=>"连云港市", :province=>"江苏省"},{"lng"=>119.030186, "lat"=>33.606513, :city=>"淮安市", :province=>"江苏省"},{"lng"=>118.296893, "lat"=>33.95205, :city=>"宿迁市", :province=>"江苏省"},{"lng"=>120.148872, "lat"=>33.379862, :city=>"盐城市", :province=>"江苏省"},{"lng"=>119.427778, "lat"=>32.408505, :city=>"扬州市", :province=>"江苏省"},{"lng"=>119.919606, "lat"=>32.476053, :city=>"泰州市", :province=>"江苏省"},{"lng"=>120.873801, "lat"=>32.014665, :city=>"南通市", :province=>"江苏省"},{"lng"=>119.455835, "lat"=>32.204409, :city=>"镇江市", :province=>"江苏省"},{"lng"=>119.981861, "lat"=>31.771397, :city=>"常州市", :province=>"江苏省"},{"lng"=>120.305456, "lat"=>31.570037, :city=>"无锡市", :province=>"江苏省"},{"lng"=>120.619907, "lat"=>31.317987, :city=>"苏州市", :province=>"江苏省"},{"lng"=>121.579006, "lat"=>29.885259, :city=>"宁波市", :province=>"浙江省"},{"lng"=>120.219375, "lat"=>30.259244, :city=>"杭州市", :province=>"浙江省"},{"lng"=>120.690635, "lat"=>28.002838, :city=>"温州市", :province=>"浙江省"},{"lng"=>120.760428, "lat"=>30.773992, :city=>"嘉兴市", :province=>"浙江省"},{"lng"=>120.137243, "lat"=>30.877925, :city=>"湖州市", :province=>"浙江省"},{"lng"=>120.592467, "lat"=>30.002365, :city=>"绍兴市", :province=>"浙江省"},{"lng"=>119.652576, "lat"=>29.102899, :city=>"金华市", :province=>"浙江省"},{"lng"=>118.875842, "lat"=>28.95691, :city=>"衢州市", :province=>"浙江省"},{"lng"=>119.929576, "lat"=>28.4563, :city=>"丽水市", :province=>"浙江省"},{"lng"=>121.440613, "lat"=>28.668283, :city=>"台州市", :province=>"浙江省"},{"lng"=>122.169872, "lat"=>30.03601, :city=>"舟山市", :province=>"浙江省"},
        {"lng"=>117.819429, "lat"=>30.94093, :city=>"铜陵市", :province=>"安徽省"},{"lng"=>117.282699, "lat"=>31.866942, :city=>"合肥市", :province=>"安徽省"},{"lng"=>117.018639, "lat"=>32.642812, :city=>"淮南市", :province=>"安徽省"},{"lng"=>116.791447, "lat"=>33.960023, :city=>"淮北市", :province=>"安徽省"},{"lng"=>118.384108, "lat"=>31.36602, :city=>"芜湖市", :province=>"安徽省"},{"lng"=>117.35708, "lat"=>32.929499, :city=>"蚌埠市", :province=>"安徽省"},{"lng"=>118.515882, "lat"=>31.688528, :city=>"马鞍山市", :province=>"安徽省"},{"lng"=>117.058739, "lat"=>30.537898, :city=>"安庆市", :province=>"安徽省"},{"lng"=>118.29357, "lat"=>29.734435, :city=>"黄山市", :province=>"安徽省"},{"lng"=>118.32457, "lat"=>32.317351, :city=>"滁州市", :province=>"安徽省"},{"lng"=>115.820932, "lat"=>32.901211, :city=>"阜阳市", :province=>"安徽省"},{"lng"=>115.787928, "lat"=>33.871211, :city=>"亳州市", :province=>"安徽省"},{"lng"=>116.988692, "lat"=>33.636772, :city=>"宿州市", :province=>"安徽省"},{"lng"=>117.494477, "lat"=>30.660019, :city=>"池州市", :province=>"安徽省"},{"lng"=>116.505253, "lat"=>31.755558, :city=>"六安市", :province=>"安徽省"},{"lng"=>118.752096, "lat"=>30.951642, :city=>"宣城市", :province=>"安徽省"},{"lng"=>119.330221, "lat"=>26.047125, :city=>"福州市", :province=>"福建省"},{"lng"=>118.103886, "lat"=>24.489231, :city=>"厦门市", :province=>"福建省"},{"lng"=>117.642194, "lat"=>26.270835, :city=>"三明市", :province=>"福建省"},{"lng"=>119.077731, "lat"=>25.44845, :city=>"莆田市", :province=>"福建省"},{"lng"=>118.600362, "lat"=>24.901652, :city=>"泉州市", :province=>"福建省"},{"lng"=>117.676205, "lat"=>24.517065, :city=>"漳州市", :province=>"福建省"},{"lng"=>118.181883, "lat"=>26.643626, :city=>"南平市", :province=>"福建省"},{"lng"=>117.017997, "lat"=>25.078685, :city=>"龙岩市", :province=>"福建省"},{"lng"=>119.542082, "lat"=>26.656527, :city=>"宁德市", :province=>"福建省"},{"lng"=>115.893528, "lat"=>28.689578, :city=>"南昌市", :province=>"江西省"},{"lng"=>117.186523, "lat"=>29.303563, :city=>"景德镇市", :province=>"江西省"},{"lng"=>113.859917, "lat"=>27.639544, :city=>"萍乡市", :province=>"江西省"},{"lng"=>114.947117, "lat"=>27.822322, :city=>"新余市", :province=>"江西省"},{"lng"=>115.999848, "lat"=>29.71964, :city=>"九江市", :province=>"江西省"},{"lng"=>117.03545, "lat"=>28.24131, :city=>"鹰潭市", :province=>"江西省"},{"lng"=>117.955464, "lat"=>28.457623, :city=>"上饶市", :province=>"江西省"},{"lng"=>114.400039, "lat"=>27.81113, :city=>"宜春市", :province=>"江西省"},{"lng"=>116.360919, "lat"=>27.954545, :city=>"抚州市", :province=>"江西省"},{"lng"=>114.992039, "lat"=>27.113848, :city=>"吉安市", :province=>"江西省"},{"lng"=>114.935909, "lat"=>25.845296, :city=>"赣州市", :province=>"江西省"},
        {"lng"=>117.024967, "lat"=>36.682785, :city=>"济南市", :province=>"山东省"},{"lng"=>120.384428, "lat"=>36.105215, :city=>"青岛市", :province=>"山东省"},{"lng"=>118.059134, "lat"=>36.804685, :city=>"淄博市", :province=>"山东省"},{"lng"=>117.279305, "lat"=>34.807883, :city=>"枣庄市", :province=>"山东省"},{"lng"=>118.583926, "lat"=>37.487121, :city=>"东营市", :province=>"山东省"},{"lng"=>119.142634, "lat"=>36.716115, :city=>"潍坊市", :province=>"山东省"},{"lng"=>121.309555, "lat"=>37.536562, :city=>"烟台市", :province=>"山东省"},{"lng"=>122.093958, "lat"=>37.528787, :city=>"威海市", :province=>"山东省"},{"lng"=>117.684667, "lat"=>36.233654, :city=>"莱芜市", :province=>"山东省"},{"lng"=>116.328161, "lat"=>37.460826, :city=>"德州市", :province=>"山东省"},{"lng"=>118.340768, "lat"=>35.072409, :city=>"临沂市", :province=>"山东省"},{"lng"=>115.986869, "lat"=>36.455829, :city=>"聊城市", :province=>"山东省"},{"lng"=>117.968292, "lat"=>37.405314, :city=>"滨州市", :province=>"山东省"},{"lng"=>115.46336, "lat"=>35.26244, :city=>"菏泽市", :province=>"山东省"},{"lng"=>119.50718, "lat"=>35.420225, :city=>"日照市", :province=>"山东省"},{"lng"=>117.089415, "lat"=>36.188078, :city=>"泰安市", :province=>"山东省"},{"lng"=>116.600798, "lat"=>35.402122, :city=>"济宁市", :province=>"山东省"},
        {"lng"=>113.649644, "lat"=>34.75661, :city=>"郑州市", :province=>"河南省"},{"lng"=>114.351642, "lat"=>34.801854, :city=>"开封市", :province=>"河南省"},{"lng"=>112.447525, "lat"=>34.657368, :city=>"洛阳市", :province=>"河南省"},{"lng"=>113.300849, "lat"=>33.745301, :city=>"平顶山市", :province=>"河南省"},{"lng"=>113.211836, "lat"=>35.234608, :city=>"焦作市", :province=>"河南省"},{"lng"=>114.29777, "lat"=>35.755426, :city=>"鹤壁市", :province=>"河南省"},{"lng"=>113.91269, "lat"=>35.307258, :city=>"新乡市", :province=>"河南省"},{"lng"=>114.351807, "lat"=>36.110267, :city=>"安阳市", :province=>"河南省"},{"lng"=>115.026627, "lat"=>35.753298, :city=>"濮阳市", :province=>"河南省"},{"lng"=>113.835312, "lat"=>34.02674, :city=>"许昌市", :province=>"河南省"},{"lng"=>114.046061, "lat"=>33.576279, :city=>"漯河市", :province=>"河南省"},{"lng"=>111.181262, "lat"=>34.78332, :city=>"三门峡市", :province=>"河南省"},{"lng"=>112.542842, "lat"=>33.01142, :city=>"南阳市", :province=>"河南省"},{"lng"=>115.641886, "lat"=>34.438589, :city=>"商丘市", :province=>"河南省"},{"lng"=>114.654102, "lat"=>33.623741, :city=>"周口市", :province=>"河南省"},{"lng"=>114.049154, "lat"=>32.983158, :city=>"驻马店市", :province=>"河南省"},{"lng"=>114.085491, "lat"=>32.128582, :city=>"信阳市", :province=>"河南省"},{"lng"=>112.405268, "lat"=>35.105365, :city=>"济源市", :province=>"河南省"},{"lng"=>114.3162, "lat"=>30.581084, :city=>"武汉市", :province=>"湖北省"},{"lng"=>115.050683, "lat"=>30.216127, :city=>"黄石市", :province=>"湖北省"},{"lng"=>112.250093, "lat"=>32.229169, :city=>"襄阳市", :province=>"湖北省"},{"lng"=>110.801229, "lat"=>32.636994, :city=>"十堰市", :province=>"湖北省"},{"lng"=>112.241866, "lat"=>30.332591, :city=>"荆州市", :province=>"湖北省"},{"lng"=>111.310981, "lat"=>30.732758, :city=>"宜昌市", :province=>"湖北省"},{"lng"=>113.935734, "lat"=>30.927955, :city=>"孝感市", :province=>"湖北省"},{"lng"=>114.906618, "lat"=>30.446109, :city=>"黄冈市", :province=>"湖北省"},{"lng"=>114.300061, "lat"=>29.880657, :city=>"咸宁市", :province=>"湖北省"},{"lng"=>114.895594, "lat"=>30.384439, :city=>"鄂州市", :province=>"湖北省"},{"lng"=>112.21733, "lat"=>31.042611, :city=>"荆门市", :province=>"湖北省"},{"lng"=>113.379358, "lat"=>31.717858, :city=>"随州市", :province=>"湖北省"},{"lng"=>112.768768, "lat"=>30.343116, :city=>"潜江市", :province=>"湖北省"},{"lng"=>113.12623, "lat"=>30.649047, :city=>"天门市", :province=>"湖北省"},{"lng"=>113.387448, "lat"=>30.293966, :city=>"仙桃市", :province=>"湖北省"},{"lng"=>110.487231, "lat"=>31.595768, :city=>"神农架林区", :province=>"湖北省"},{"lng"=>112.979353, "lat"=>28.213478, :city=>"长沙市", :province=>"湖南省"},{"lng"=>113.131695, "lat"=>27.827433, :city=>"株洲市", :province=>"湖南省"},{"lng"=>112.935556, "lat"=>27.835095, :city=>"湘潭市", :province=>"湖南省"},{"lng"=>112.533095, "lat"=>27.927333, :city=>"韶山市", :province=>"湖南省"},{"lng"=>112.583819, "lat"=>26.898164, :city=>"衡阳市", :province=>"湖南省"},{"lng"=>111.461525, "lat"=>27.236811, :city=>"邵阳市", :province=>"湖南省"},{"lng"=>113.146196, "lat"=>29.378007, :city=>"岳阳市", :province=>"湖南省"},{"lng"=>111.653718, "lat"=>29.012149, :city=>"常德市", :province=>"湖南省"},{"lng"=>110.48162, "lat"=>29.124889, :city=>"张家界市", :province=>"湖南省"},{"lng"=>113.037704, "lat"=>25.782264, :city=>"郴州市", :province=>"湖南省"},{"lng"=>112.366547, "lat"=>28.588088, :city=>"益阳市", :province=>"湖南省"},{"lng"=>111.614648, "lat"=>26.435972, :city=>"永州市", :province=>"湖南省"},{"lng"=>109.986959, "lat"=>27.557483, :city=>"怀化市", :province=>"湖南省"},{"lng"=>111.996396, "lat"=>27.741073, :city=>"娄底市", :province=>"湖南省"},{"lng"=>109.745746, "lat"=>28.317951, :city=>"湘西州", :province=>"湖南省"},{"lng"=>112.921552, "lat"=>26.423993, :city=>"耒阳市", :province=>"湖南省"},{"lng"=>113.30765, "lat"=>23.120049, :city=>"广州市", :province=>"广东省"},{"lng"=>114.025974, "lat"=>22.546054, :city=>"深圳市", :province=>"广东省"},{"lng"=>113.562447, "lat"=>22.256915, :city=>"珠海市", :province=>"广东省"},{"lng"=>116.72865, "lat"=>23.383908, :city=>"汕头市", :province=>"广东省"},{"lng"=>113.594461, "lat"=>24.80296, :city=>"韶关市", :province=>"广东省"},{"lng"=>114.713721, "lat"=>23.757251, :city=>"河源市", :province=>"广东省"},{"lng"=>116.126403, "lat"=>24.304571, :city=>"梅州市", :province=>"广东省"},{"lng"=>114.410658, "lat"=>23.11354, :city=>"惠州市", :province=>"广东省"},{"lng"=>115.372924, "lat"=>22.778731, :city=>"汕尾市", :province=>"广东省"},{"lng"=>113.763434, "lat"=>23.043024, :city=>"东莞市", :province=>"广东省"},{"lng"=>113.42206, "lat"=>22.545178, :city=>"中山市", :province=>"广东省"},{"lng"=>113.078125, "lat"=>22.575117, :city=>"江门市", :province=>"广东省"},{"lng"=>113.134026, "lat"=>23.035095, :city=>"佛山市", :province=>"广东省"},{"lng"=>111.97701, "lat"=>21.871517, :city=>"阳江市", :province=>"广东省"},{"lng"=>110.365067, "lat"=>21.257463, :city=>"湛江市", :province=>"广东省"},{"lng"=>110.931245, "lat"=>21.668226, :city=>"茂名市", :province=>"广东省"},{"lng"=>112.479653, "lat"=>23.078663, :city=>"肇庆市", :province=>"广东省"},{"lng"=>112.050946, "lat"=>22.937976, :city=>"云浮市", :province=>"广东省"},{"lng"=>113.040773, "lat"=>23.698469, :city=>"清远市", :province=>"广东省"},{"lng"=>116.630076, "lat"=>23.661812, :city=>"潮州市", :province=>"广东省"},{"lng"=>116.379501, "lat"=>23.547999, :city=>"揭阳市", :province=>"广东省"},{"lng"=>108.297234, "lat"=>22.806493, :city=>"南宁市", :province=>"广西壮族自治区"},{"lng"=>109.422402, "lat"=>24.329053, :city=>"柳州市", :province=>"广西壮族自治区"},{"lng"=>110.26092, "lat"=>25.262901, :city=>"桂林市", :province=>"广西壮族自治区"},{"lng"=>111.305472, "lat"=>23.485395, :city=>"梧州市", :province=>"广西壮族自治区"},{"lng"=>109.122628, "lat"=>21.472718, :city=>"北海市", :province=>"广西壮族自治区"},{"lng"=>108.351791, "lat"=>21.617398, :city=>"防城港市", :province=>"广西壮族自治区"},{"lng"=>108.638798, "lat"=>21.97335, :city=>"钦州市", :province=>"广西壮族自治区"},{"lng"=>109.613708, "lat"=>23.103373, :city=>"贵港市", :province=>"广西壮族自治区"},{"lng"=>110.151676, "lat"=>22.643974, :city=>"玉林市", :province=>"广西壮族自治区"},{"lng"=>111.552594, "lat"=>24.411054, :city=>"贺州市", :province=>"广西壮族自治区"},{"lng"=>106.631821, "lat"=>23.901512, :city=>"百色市", :province=>"广西壮族自治区"},{"lng"=>108.069948, "lat"=>24.699521, :city=>"河池市", :province=>"广西壮族自治区"},{"lng"=>109.231817, "lat"=>23.741166, :city=>"来宾市", :province=>"广西壮族自治区"},{"lng"=>107.357322, "lat"=>22.415455, :city=>"崇左市", :province=>"广西壮族自治区"},{"lng"=>110.330802, "lat"=>20.022071, :city=>"海口市", :province=>"海南省"},{"lng"=>109.413973, "lat"=>19.571153, :city=>"儋州市", :province=>"海南省"},{"lng"=>110.414359, "lat"=>19.21483, :city=>"琼海市", :province=>"海南省"},{"lng"=>110.292505, "lat"=>18.839886, :city=>"万宁市", :province=>"海南省"},{"lng"=>108.85101, "lat"=>18.998161, :city=>"东方市", :province=>"海南省"},{"lng"=>109.522771, "lat"=>18.257776, :city=>"三亚市", :province=>"海南省"},{"lng"=>110.780909, "lat"=>19.750947, :city=>"文昌市", :province=>"海南省"},{"lng"=>109.51775, "lat"=>18.831306, :city=>"五指山市", :province=>"海南省"},{"lng"=>109.724102, "lat"=>19.805922, :city=>"临高县", :province=>"海南省"},{"lng"=>109.996736, "lat"=>19.693135, :city=>"澄迈县", :province=>"海南省"},{"lng"=>110.32009, "lat"=>19.490991, :city=>"定安县", :province=>"海南省"},{"lng"=>110.063364, "lat"=>19.347749, :city=>"屯昌县", :province=>"海南省"},{"lng"=>117.1862, "lat"=>29.272155, :city=>"昌江县", :province=>"海南省"},{"lng"=>109.358586, "lat"=>19.216056, :city=>"白沙县", :province=>"海南省"},{"lng"=>109.861849, "lat"=>19.039771, :city=>"琼中县", :province=>"海南省"},{"lng"=>109.948661, "lat"=>18.575985, :city=>"陵水县", :province=>"海南省"},{"lng"=>109.656113, "lat"=>18.597592, :city=>"保亭县", :province=>"海南省"},{"lng"=>109.062698, "lat"=>18.658614, :city=>"乐东县", :province=>"海南省"},{"lng"=>104.067923, "lat"=>30.679943, :city=>"成都市", :province=>"四川省"},{"lng"=>104.776071, "lat"=>29.359157, :city=>"自贡市", :province=>"四川省"},{"lng"=>101.722423, "lat"=>26.587571, :city=>"攀枝花市", :province=>"四川省"},{"lng"=>105.44397, "lat"=>28.89593, :city=>"泸州市", :province=>"四川省"},{"lng"=>104.705519, "lat"=>31.504701, :city=>"绵阳市", :province=>"四川省"},{"lng"=>104.402398, "lat"=>31.13114, :city=>"德阳市", :province=>"四川省"},{"lng"=>105.819687, "lat"=>32.44104, :city=>"广元市", :province=>"四川省"},{"lng"=>105.564888, "lat"=>30.557491, :city=>"遂宁市", :province=>"四川省"},{"lng"=>105.073056, "lat"=>29.599462, :city=>"内江市", :province=>"四川省"},{"lng"=>103.760824, "lat"=>29.600958, :city=>"乐山市", :province=>"四川省"},{"lng"=>104.633019, "lat"=>28.769675, :city=>"宜宾市", :province=>"四川省"},{"lng"=>106.63572, "lat"=>30.463984, :city=>"广安市", :province=>"四川省"},{"lng"=>106.105554, "lat"=>30.800965, :city=>"南充市", :province=>"四川省"},{"lng"=>107.494973, "lat"=>31.214199, :city=>"达州市", :province=>"四川省"},{"lng"=>106.757916, "lat"=>31.869189, :city=>"巴中市", :province=>"四川省"},{"lng"=>103.009356, "lat"=>29.999716, :city=>"雅安市", :province=>"四川省"},{"lng"=>103.84143, "lat"=>30.061115, :city=>"眉山市", :province=>"四川省"},{"lng"=>104.63593, "lat"=>30.132191, :city=>"资阳市", :province=>"四川省"},{"lng"=>102.228565, "lat"=>31.905763, :city=>"阿坝州", :province=>"四川省"},{"lng"=>101.969232, "lat"=>30.055144, :city=>"甘孜州", :province=>"四川省"},{"lng"=>102.259591, "lat"=>27.892393, :city=>"凉山州", :province=>"四川省"},{"lng"=>106.709177, "lat"=>26.629907, :city=>"贵阳市", :province=>"贵州省"},{"lng"=>104.852087, "lat"=>26.591866, :city=>"六盘水市", :province=>"贵州省"},{"lng"=>106.93126, "lat"=>27.699961, :city=>"遵义市", :province=>"贵州省"},{"lng"=>109.168558, "lat"=>27.674903, :city=>"铜仁市", :province=>"贵州省"},{"lng"=>105.333323, "lat"=>27.408562, :city=>"毕节市", :province=>"贵州省"},{"lng"=>105.92827, "lat"=>26.228595, :city=>"安顺市", :province=>"贵州省"},{"lng"=>106.120805, "lat"=>27.050413, :city=>"黔西南州", :province=>"贵州省"},{"lng"=>107.523205, "lat"=>26.264536, :city=>"黔南州", :province=>"贵州省"},{"lng"=>102.714601, "lat"=>25.049153, :city=>"昆明市", :province=>"云南省"},{"lng"=>103.782539, "lat"=>25.520758, :city=>"曲靖市", :province=>"云南省"},{"lng"=>102.545068, "lat"=>24.370447, :city=>"玉溪市", :province=>"云南省"},{"lng"=>103.725021, "lat"=>27.340633, :city=>"昭通市", :province=>"云南省"},{"lng"=>100.980058, "lat"=>22.788778, :city=>"普洱市", :province=>"云南省"},{"lng"=>100.092613, "lat"=>23.887806, :city=>"临沧市", :province=>"云南省"},{"lng"=>99.177996, "lat"=>25.120489, :city=>"保山市", :province=>"云南省"},{"lng"=>100.229628, "lat"=>26.875351, :city=>"丽江市", :province=>"云南省"},{"lng"=>104.246294, "lat"=>23.374087, :city=>"文山州", :province=>"云南省"},{"lng"=>103.384065, "lat"=>23.367718, :city=>"红河州", :province=>"云南省"},{"lng"=>100.803038, "lat"=>22.009433, :city=>"西双版纳州", :province=>"云南省"},{"lng"=>101.529382, "lat"=>25.066356, :city=>"楚雄彝族自治州", :province=>"云南省"},{"lng"=>100.223675, "lat"=>25.5969, :city=>"大理白族自治州", :province=>"云南省"},{"lng"=>98.589434, "lat"=>24.44124, :city=>"德宏州", :province=>"云南省"},{"lng"=>98.859932, "lat"=>25.860677, :city=>"怒江州", :province=>"云南省"},{"lng"=>99.713682, "lat"=>27.831029, :city=>"迪庆州", :province=>"云南省"},{"lng"=>91.111891, "lat"=>29.662557, :city=>"拉萨市", :province=>"西藏自治区"},{"lng"=>92.067018, "lat"=>31.48068, :city=>"那曲地区", :province=>"西藏自治区"},{"lng"=>91.750644, "lat"=>29.229027, :city=>"山南地区", :province=>"西藏自治区"},{"lng"=>97.185582, "lat"=>31.140576, :city=>"昌都地区", :province=>"西藏自治区"},{"lng"=>88.891486, "lat"=>29.269023, :city=>"日喀则地区", :province=>"西藏自治区"},{"lng"=>81.107669, "lat"=>30.404557, :city=>"阿里地区", :province=>"西藏自治区"},{"lng"=>94.349985, "lat"=>29.666941, :city=>"林芝地区", :province=>"西藏自治区"},{"lng"=>108.953098, "lat"=>34.2778, :city=>"西安市", :province=>"陕西省"},{"lng"=>108.968067, "lat"=>34.908368, :city=>"铜川市", :province=>"陕西省"},{"lng"=>107.170645, "lat"=>34.364081, :city=>"宝鸡市", :province=>"陕西省"},{"lng"=>108.707509, "lat"=>34.345373, :city=>"咸阳市", :province=>"陕西省"},{"lng"=>109.483933, "lat"=>34.502358, :city=>"渭南市", :province=>"陕西省"},{"lng"=>109.50051, "lat"=>36.60332, :city=>"延安市", :province=>"陕西省"},{"lng"=>107.045478, "lat"=>33.081569, :city=>"汉中市", :province=>"陕西省"},{"lng"=>109.745926, "lat"=>38.279439, :city=>"榆林市", :province=>"陕西省"},{"lng"=>109.934208, "lat"=>33.873907, :city=>"商洛市", :province=>"陕西省"},{"lng"=>109.038045, "lat"=>32.70437, :city=>"安康市", :province=>"陕西省"},{"lng"=>103.823305, "lat"=>36.064226, :city=>"兰州市", :province=>"甘肃省"},{"lng"=>102.208126, "lat"=>38.516072, :city=>"金昌市", :province=>"甘肃省"},{"lng"=>104.171241, "lat"=>36.546682, :city=>"白银市", :province=>"甘肃省"},{"lng"=>105.736932, "lat"=>34.584319, :city=>"天水市", :province=>"甘肃省"},{"lng"=>98.281635, "lat"=>39.802397, :city=>"嘉峪关市", :province=>"甘肃省"},{"lng"=>106.688911, "lat"=>35.55011, :city=>"平凉市", :province=>"甘肃省"},{"lng"=>107.644227, "lat"=>35.726801, :city=>"庆阳市", :province=>"甘肃省"},{"lng"=>104.934573, "lat"=>33.39448, :city=>"陇南市", :province=>"甘肃省"},{"lng"=>102.640147, "lat"=>37.933172, :city=>"武威市", :province=>"甘肃省"},{"lng"=>100.459892, "lat"=>38.93932, :city=>"张掖市", :province=>"甘肃省"},{"lng"=>98.508415, "lat"=>39.741474, :city=>"酒泉市", :province=>"甘肃省"},{"lng"=>102.917442, "lat"=>34.992211, :city=>"甘南藏族自治州", :province=>"甘肃省"},{"lng"=>103.215249, "lat"=>35.598514, :city=>"临夏回族自治州", :province=>"甘肃省"},{"lng"=>104.626638, "lat"=>35.586056, :city=>"定西市", :province=>"甘肃省"},{"lng"=>106.206479, "lat"=>38.502621, :city=>"银川市", :province=>"宁夏回族自治区"},{"lng"=>106.379337, "lat"=>39.020223, :city=>"石嘴山市", :province=>"宁夏回族自治区"},{"lng"=>106.208254, "lat"=>37.993561, :city=>"吴忠市", :province=>"宁夏回族自治区"},{"lng"=>106.285268, "lat"=>36.021523, :city=>"固原市", :province=>"宁夏回族自治区"},{"lng"=>105.196754, "lat"=>37.521124, :city=>"中卫市", :province=>"宁夏回族自治区"},{"lng"=>101.767921, "lat"=>36.640739, :city=>"西宁市", :province=>"青海省"},{"lng"=>102.085207, "lat"=>36.51761, :city=>"海东地区", :province=>"青海省"},{"lng"=>100.879802, "lat"=>36.960654, :city=>"海北州", :province=>"青海省"},{"lng"=>102.0076, "lat"=>35.522852, :city=>"黄南藏族自治州", :province=>"青海省"},{"lng"=>100.624066, "lat"=>36.284364, :city=>"海南藏族自治州", :province=>"青海省"},{"lng"=>100.223723, "lat"=>34.480485, :city=>"果洛藏族自治州", :province=>"青海省"},{"lng"=>97.013316, "lat"=>33.00624, :city=>"玉树藏族自治州", :province=>"青海省"},{"lng"=>97.342625, "lat"=>37.373799, :city=>"海西州", :province=>"青海省"},{"lng"=>87.564988, "lat"=>43.84038, :city=>"乌鲁木齐市", :province=>"新疆维吾尔自治区‎"},{"lng"=>84.88118, "lat"=>45.594331, :city=>"克拉玛依市", :province=>"新疆维吾尔自治区‎"},{"lng"=>86.041865, "lat"=>44.308259, :city=>"石河子市", :province=>"新疆维吾尔自治区‎"},{"lng"=>89.181595, "lat"=>42.96047, :city=>"吐鲁番地区", :province=>"新疆维吾尔自治区‎"},{"lng"=>93.528355, "lat"=>42.858596, :city=>"哈密地区", :province=>"新疆维吾尔自治区‎"},{"lng"=>79.930239, "lat"=>37.116774, :city=>"和田地区", :province=>"新疆维吾尔自治区‎"},{"lng"=>80.269846, "lat"=>41.171731, :city=>"阿克苏地区", :province=>"新疆维吾尔自治区‎"},{"lng"=>75.992973, "lat"=>39.470627, :city=>"喀什地区", :province=>"新疆维吾尔自治区‎"},{"lng"=>76.87994, "lat"=>40.876922, :city=>"克孜勒苏州", :province=>"新疆维吾尔自治区‎"},{"lng"=>86.121688, "lat"=>41.771362, :city=>"巴音郭楞蒙古自治州", :province=>"新疆维吾尔自治区‎"},{"lng"=>87.296038, "lat"=>44.007058, :city=>"昌吉回族自治州", :province=>"新疆维吾尔自治区‎"},{"lng"=>82.052436, "lat"=>44.913651, :city=>"博尔塔拉蒙古自治州", :province=>"新疆维吾尔自治区‎"},{"lng"=>81.297854, "lat"=>43.922248, :city=>"伊犁哈萨克自治州", :province=>"新疆维吾尔自治区‎"},{"lng"=>82.974881, "lat"=>46.758684, :city=>"塔城地区", :province=>"新疆维吾尔自治区‎"},{"lng"=>88.137915, "lat"=>47.839744, :city=>"阿勒泰地区", :province=>"新疆维吾尔自治区‎"},{"lng"=>87.565449, "lat"=>44.368899, :city=>"五家渠市", :province=>"新疆维吾尔自治区‎"},{"lng"=>81.291737, "lat"=>40.61568, :city=>"阿拉尔市", :province=>"新疆维吾尔自治区‎"},{"lng"=>79.198155, "lat"=>39.889223, :city=>"图木舒克市", :province=>"新疆维吾尔自治区‎"},{"lng"=>114.186124, "lat"=>22.293586, :city=>"香港", :province=>"香港"},{"lng"=>113.557519, "lat"=>22.204118, :city=>"澳门", :province=>"澳门"},
      ]    
      @matrix = []
      @sites.each do |s1|
        @sites.each do |s2|
          d1 = (s1["lat"] - s2["lat"]).abs
          d2 = (s1["lng"] - s2["lng"]).abs
          @matrix.push({:start=>s1[:city],:end=>s2[:city],:distance=>Math.sqrt(d1*d1 + d2*d2)})
        end
      end
    end
    @sites.select{|x| x[:city]=~/^#{city}/}.first
  end

  def self.find_near(city)
    return nil unless confirm_city(city)
    xx = @matrix.select{|x| x[:start]==city}.sort{|x,y| x[:distance]<=>y[:distance]}
    xx[1]
  end
  
  def self.format_city city
    if city.level == 3
      return [city["father"]["father"]["name"],city["father"]["name"],city["name"]]
    elsif city.level == 2
      return [city["father"]["name"],city["name"],""]
    else
      return [city["name"],"",""]
    end
  end

  def self.confirm_region address
    address = address.gsub /[( )]/,''
    args = address.split(/(?<=[省市区县])\s*/)
    x = args.index{|x| x=~/市|区/ && x.length > 5}
    if x && args[x+1] then
      args[x] = args[x] + args[x+1] 
      args.delete_at(x+1)
    end
    if args.length >=4 then #best format
      # province = Region.get_region(args[0])
      city = Region.get_region(args[1])
      county = Region.get_region(args[2],city)
      return nil if !(city && county)
      return format_city(county)
      # return [city["father"]["name"],city["name"],county["name"]]      
    end
    if args.length ==3 then #try the 
      if args[0]=~/省/ then  # xx省xx市xxx
        city = Region.get_region(args[1])
        return nil if !city
        return format_city(city)
      end
      if args[0]=~/市/ then # xx市xx区xxx
        city = Region.get_region(args[0])
        county = Region.get_region(args[1],city)
        return nil if !(city && county)
        return format_city(county)
      end
    end
    if args.length ==2 then #try to fit with county, if not try city
      city = Region.get_region(args[0])
      return nil if !city
      return format_city(city)
    end
    return nil
  end

  def summary_address
    "#{province}-#{city}-#{county}"
  end

  def summary
  	"#{name},地址:#{address},电话:#{phone},联系人:#{contactor}"
  end

end
